<!DOCTYPE html>
<html lang="ja">
<head>
     <meta http-equiv="Content-Security-Policy" 
      content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; 
               script-src * 'unsafe-inline' 'unsafe-eval'; 
               connect-src *; 
               img-src * data: blob: 'unsafe-inline'; 
               frame-src *; 
               style-src * 'unsafe-inline';">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµŒè²»ç²¾ç®—AI - ãƒ¬ã‚·ãƒ¼ãƒˆè‡ªå‹•èª­ã¿å–ã‚Š</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='50%' x='50%' text-anchor='middle' font-size='80'>ğŸ“±</text></svg>">
    <link rel="stylesheet" href="styles.css">
     <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    
    <!-- Google DriveåŒæœŸç”¨ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
    .sync-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 1rem;
        color: white;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .sync-status-bar {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    #googleSignInBtn {
        background: white;
        color: #4285f4;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
        cursor: pointer;
    }
    
    .sync-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex: 1;
    }
    
    #syncStatus.active { color: #4ade80; }
    
    #syncIndicator.active {
        display: inline-block;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    </style>
</head>
<!-- Google API Client Library -->
<script src="https://apis.google.com/js/api.js"></script>
<body>
    <!-- Google DriveåŒæœŸãƒãƒ¼ï¼ˆæœ€ä¸Šéƒ¨ï¼‰ -->
    <div class="sync-container">
        <div class="sync-status-bar">
            <button id="googleSignInBtn" class="btn btn-primary">
                ğŸ” Googleãƒ‰ãƒ©ã‚¤ãƒ–ã¨é€£æº
            </button>
            <div class="sync-info">
                <span id="syncStatus">âŒ åŒæœŸ: OFF</span>
                <span id="syncIndicator"></span>
                <span id="lastSyncTime"></span>
            </div>
            <button id="manualSyncBtn" class="btn btn-secondary" style="display: none;">
                ğŸ”„ ä»Šã™ãåŒæœŸ
            </button>
        </div>
    </div>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="app-header">
        <div class="header-content">
            <h1 class="app-title">
                <span class="logo">ğŸ“±</span>
                <span>çµŒè²»ç²¾ç®—AI</span>
                <span class="badge">BETA</span>
            </h1>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="monthlyTotal">Â¥0</span>
                    <span class="stat-label">ä»Šæœˆã®çµŒè²»</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="app-main">
        <!-- ãƒ¬ã‚·ãƒ¼ãƒˆæ’®å½±ã‚¨ãƒªã‚¢ -->
        <section class="capture-section">
            <div class="capture-card">
                <h2>ãƒ¬ã‚·ãƒ¼ãƒˆæ’®å½±ãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
                <div class="capture-area" id="captureArea">
                    <input type="file" id="receiptInput" accept="image/*" capture="environment" hidden>
                    <label for="receiptInput" class="capture-button">
                        <span class="camera-icon">ğŸ“·</span>
                        <span>ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±</span>
                    </label>
                    <div class="upload-hint">ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
                </div>
                
                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                <div id="imagePreview" class="image-preview hidden">
                    <img id="previewImg" alt="ãƒ¬ã‚·ãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
                    <div class="ocr-status" id="ocrStatus"></div>
                </div>
                
                <!-- AIè§£æçµæœ -->
                <div id="ocrResult" class="ocr-result hidden">
                    <h3>ğŸ¤– AIè§£æçµæœ</h3>
                    <div class="extracted-data">
                        <div class="data-field">
                            <label>åº—èˆ—å</label>
                            <input type="text" id="storeName" placeholder="è‡ªå‹•æ¤œå‡ºä¸­...">
                        </div>
                        <div class="data-field">
                            <label>æ—¥ä»˜</label>
                            <input type="date" id="expenseDate">
                        </div>
                        <div class="data-field">
                            <label>é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</label>
                            <input type="number" id="amount" placeholder="0">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- çµŒè²»å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <section class="input-section">
            <div class="expense-form">
                <h2>çµŒè²»è©³ç´°</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼ <span class="required">*</span></label>
                        <select id="category" class="form-control">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="äº¤é€šè²»">ğŸšƒ äº¤é€šè²»</option>
                            <option value="ä¼šè­°è²»">â˜• ä¼šè­°è²»</option>
                            <option value="æ¥å¾…äº¤éš›è²»">ğŸ½ï¸ æ¥å¾…äº¤éš›è²»</option>
                            <option value="æ¶ˆè€—å“è²»">ğŸ“ æ¶ˆè€—å“è²»</option>
                            <option value="é€šä¿¡è²»">ğŸ“± é€šä¿¡è²»</option>
                            <option value="å›³æ›¸ç ”ç©¶è²»">ğŸ“š å›³æ›¸ç ”ç©¶è²»</option>
                            <option value="æ—…è²»äº¤é€šè²»">âœˆï¸ æ—…è²»äº¤é€šè²»</option>
                            <option value="ãã®ä»–">ğŸ“ ãã®ä»–</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>æ”¯æ‰•æ–¹æ³•</label>
                        <select id="paymentMethod" class="form-control">
                            <option value="ç¾é‡‘">ğŸ’µ ç¾é‡‘</option>
                            <option value="ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰">ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</option>
                            <option value="é›»å­ãƒãƒãƒ¼">ğŸ“± é›»å­ãƒãƒãƒ¼</option>
                            <option value="éŠ€è¡ŒæŒ¯è¾¼">ğŸ¦ éŠ€è¡ŒæŒ¯è¾¼</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</label>
                        <input type="text" id="project" class="form-control" placeholder="ä¾‹ï¼šAç¤¾æ¡ˆä»¶">
                    </div>
                    
                    <div class="form-group">
                        <label>å‚™è€ƒ</label>
                        <input type="text" id="memo" class="form-control" placeholder="ä¾‹ï¼šæ‰“ã¡åˆã‚ã›">
                    </div>
                </div>
                
                <!-- ã‚¤ãƒ³ãƒœã‚¤ã‚¹å¯¾å¿œ -->
                <div class="invoice-section">
                    <h3>ã‚¤ãƒ³ãƒœã‚¤ã‚¹æƒ…å ±</h3>
                    <div class="tax-calculation">
                        <div class="tax-row">
                            <span>ç¨æŠœé‡‘é¡ï¼š</span>
                            <span id="taxExcluded">Â¥0</span>
                        </div>
                        <div class="tax-row">
                            <span>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰ï¼š</span>
                            <span id="taxAmount">Â¥0</span>
                        </div>
                        <div class="tax-row">
                            <span>æ¶ˆè²»ç¨ï¼ˆ8%ï¼‰ï¼š</span>
                            <span id="taxAmount8">Â¥0</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç•ªå·ï¼ˆä»»æ„ï¼‰</label>
                        <input type="text" id="invoiceNumber" class="form-control" placeholder="T1234567890123">
                    </div>
                </div>
                
                <button id="saveExpense" class="btn btn-primary">
                    <span>ğŸ’¾</span> çµŒè²»ã‚’ä¿å­˜
                </button>
            </div>
        </section>

        <!-- çµŒè²»ä¸€è¦§ -->
        <section class="list-section">
            <div class="list-header">
                <h2>çµŒè²»ä¸€è¦§</h2>
                <div class="list-actions">
                    <button id="exportCSV" class="btn btn-secondary">
                        <span>ğŸ“Š</span> CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button id="generateReport" class="btn btn-secondary">
                        <span>ğŸ“„</span> æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
                    </button>
                </div>
            </div>
            
            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div class="filter-bar">
                <select id="filterMonth" class="filter-control">
                    <option value="">å…¨æœŸé–“</option>
                </select>
                <select id="filterCategory" class="filter-control">
                    <option value="">å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                </select>
                <input type="text" id="searchBox" class="filter-control" placeholder="ğŸ” æ¤œç´¢...">
            </div>
            
            <!-- çµŒè²»ãƒªã‚¹ãƒˆ -->
            <div id="expenseList" class="expense-list">
                <div class="empty-state">
                    <span class="empty-icon">ğŸ“‹</span>
                    <p>ã¾ã çµŒè²»ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                    <p class="empty-hint">ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±ã—ã¦å§‹ã‚ã¾ã—ã‚‡ã†</p>
                </div>
            </div>
        </section>

        <!-- çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <section class="stats-section">
            <h2>ğŸ“Š çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalExpenses">0</div>
                        <div class="stat-label">ç·çµŒè²»ä»¶æ•°</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalAmount">Â¥0</div>
                        <div class="stat-label">ç·çµŒè²»é‡‘é¡</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“…</div>
                    <div class="stat-content">
                        <div class="stat-number" id="avgDaily">Â¥0</div>
                        <div class="stat-label">æ—¥å¹³å‡</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ·ï¸</div>
                    <div class="stat-content">
                        <div class="stat-number" id="topCategory">-</div>
                        <div class="stat-label">æœ€å¤šã‚«ãƒ†ã‚´ãƒªãƒ¼</div>
                    </div>
                </div>
            </div>
            
            <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥é›†è¨ˆ -->
            <div class="category-breakdown">
                <h3>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥é›†è¨ˆ</h3>
                <div id="categoryChart" class="chart-container"></div>
            </div>
        </section>
    </main>

    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <button class="fab" id="quickAddBtn">
        <span>+</span>
    </button>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æœˆæ¬¡çµŒè²»ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div id="reportContent" class="report-content">
                <!-- ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
            <div class="modal-footer">
                <button onclick="printReport()" class="btn btn-primary">å°åˆ·</button>
                <button onclick="downloadPDF()" class="btn btn-secondary">PDFä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
    <div id="progressBar" class="progress-bar hidden">
        <div class="progress-fill"></div>
        <span class="progress-text">å‡¦ç†ä¸­...</span>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ï¼ˆé †åºé‡è¦ï¼‰ -->
    <script src="app.js"></script>
    
    <!-- Google API -->
     <script src="https://accounts.google.com/gsi/client"></script>
    
    <!-- Google DriveåŒæœŸï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç‰ˆï¼‰ -->
    <script>
    // ==================== è¨­å®š ====================
    // ã“ã“ã«ã‚ãªãŸã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼
    const GOOGLE_CONFIG = {
        CLIENT_ID: '179874464431-2gkjdolnfd9tbooegigp5upmkme4rbfh.apps.googleusercontent.com',  // å¿…ãšå¤‰æ›´
        API_KEY: 'AIzaSyC0RxZKGhuL6aE9usKKYzBMT9zu13P_mXw',  // å¿…ãšå¤‰æ›´
        SCOPES: 'https://www.googleapis.com/auth/drive.file'
    };
    
    // ==================== Google DriveåŒæœŸ ====================
    class GoogleDriveSync {
        constructor() {
            this.isInitialized = false;
            this.isSignedIn = false;
            this.auth = null;
        }
        
        async init() {
            return new Promise((resolve, reject) => {
                gapi.load('client:auth2', async () => {
                    try {
                        await gapi.client.init({
                            apiKey: GOOGLE_CONFIG.API_KEY,
                            clientId: GOOGLE_CONFIG.CLIENT_ID,
                            scope: GOOGLE_CONFIG.SCOPES
                        });
                        
                        this.auth = gapi.auth2.getAuthInstance();
                        this.auth.isSignedIn.listen((isSignedIn) => {
                            this.handleSignInStatus(isSignedIn);
                        });
                        
                        this.handleSignInStatus(this.auth.isSignedIn.get());
                        this.isInitialized = true;
                        
                        console.log('Google Drive Sync initialized');
                        resolve();
                    } catch (error) {
                        console.error('Init error:', error);
                        reject(error);
                    }
                });
            });
        }
        
        handleSignInStatus(isSignedIn) {
            this.isSignedIn = isSignedIn;
            this.updateUI();
            
            if (isSignedIn) {
                this.syncData();
            }
        }
        
        updateUI() {
            const signInBtn = document.getElementById('googleSignInBtn');
            const syncStatus = document.getElementById('syncStatus');
            
            if (this.isSignedIn) {
                signInBtn.innerHTML = 'ğŸ”“ Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ‡æ–­';
                syncStatus.innerHTML = 'âœ… åŒæœŸ: ON';
                syncStatus.classList.add('active');
            } else {
                signInBtn.innerHTML = 'ğŸ” Googleãƒ‰ãƒ©ã‚¤ãƒ–ã¨é€£æº';
                syncStatus.innerHTML = 'âŒ åŒæœŸ: OFF';
                syncStatus.classList.remove('active');
            }
        }
        
        async toggleSignIn() {
            if (!this.isInitialized) {
                await this.init();
            }
            
            if (this.isSignedIn) {
                await this.auth.signOut();
            } else {
                await this.auth.signIn();
            }
        }
        
        async syncData() {
            // ç°¡æ˜“åŒæœŸå®Ÿè£…
            console.log('Syncing data with Google Drive...');
        }
    }
    
    // ==================== åˆæœŸåŒ– ====================
    let googleSync = null;
    
    // Googleé€£æºãƒœã‚¿ãƒ³ã®è¨­å®š
    document.addEventListener('DOMContentLoaded', () => {
        const googleSignInBtn = document.getElementById('googleSignInBtn');
        
        if (googleSignInBtn) {
            googleSignInBtn.addEventListener('click', async () => {
                console.log('Google Sign In button clicked');
                
                try {
                    if (!googleSync) {
                        googleSync = new GoogleDriveSync();
                    }
                    await googleSync.toggleSignIn();
                } catch (error) {
                    console.error('Sign in error:', error);
                    alert('Googleé€£æºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                }
            });
        }
        
        // æ‰‹å‹•åŒæœŸãƒœã‚¿ãƒ³
        const manualSyncBtn = document.getElementById('manualSyncBtn');
        if (manualSyncBtn) {
            manualSyncBtn.addEventListener('click', () => {
                if (googleSync && googleSync.isSignedIn) {
                    googleSync.syncData();
                }
            });
        }
    });
    
    // ==================== ãã®ä»–ã®é–¢æ•° ====================
    function closeModal() {
        document.getElementById('reportModal').classList.remove('show');
    }
    
    function printReport() {
        window.print();
    }
    
    function downloadPDF() {
        window.print();
    }
    </script>
</body>
</html>










